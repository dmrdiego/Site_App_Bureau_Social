perfeito ‚Äî vasculhei o teu projeto inteiro (frontend + backend) e mapeei o que o **administrador** j√° consegue fazer e onde d√° para melhorar a **usabilidade** e **funcionalidades** (upload/remo√ß√£o de documentos, envios de e-mail aos associados, etc.). Vou te entregar:

1. o que j√° existe hoje (por √°rea)
2. os principais ‚Äúgaps‚Äù de UX/funcionalidade
3. um plano de melhorias (priorizado)
4. trechos de c√≥digo prontos para implementar r√°pido

---

## 1) O que o admin j√° tem hoje

### Navega√ß√£o/Apps

* **Dashboard** (`/dashboard`): vis√£o geral (resumo de assembleias, documentos, notifica√ß√µes).
* **Assembleias** (`/assembleias`, `/assembleias/nova`): cria e edita assembleias; gere presen√ßas e **procura√ß√µes** (delega√ß√µes); gera **ata em PDF** e disponibiliza para download.
* **Vota√ß√µes**: cria **pautas/itens de voto**, recolhe votos e calcula **resultados** com peso (considera procura√ß√µes).
* **Documentos**: lista e faz **download** de documentos (com tipos: ‚Äúata‚Äù, ‚Äúregulamento‚Äù, ‚Äúrelat√≥rio‚Äù; visibilidade: ‚Äútodos/admin/dire√ß√£o‚Äù; associa√ß√£o a uma assembleia).
* **Associados**: listagem e gest√£o de **usu√°rios**; filtragem/for-proxy; atualiza√ß√£o de status/role.
* **CMS**: edita **se√ß√µes p√∫blicas** do site (landing/home, miss√£o, servi√ßos, projetos etc.).
* **Perfil/Configura√ß√µes**: prefer√™ncias de tema, dados do usu√°rio.

### Backend (resumo dos endpoints sens√≠veis ao admin)

* **Assembleias:** `GET/POST/PUT /api/assemblies*`, presen√ßas `GET/POST`, **gera√ß√£o/baixa de ata** (`/download-minutes` / `generate-minutes`), procura√ß√µes (`/proxies`).
* **Vota√ß√µes:** criar itens, lan√ßar votos, **apurar resultados**.
* **Documentos:** `GET /api/documents`, `GET /api/documents/:id`, `GET /api/documents/:id/download` (üëâ **aqui n√£o h√° POST/DELETE ainda**).
* **Users (admin):** `GET /api/admin/users`, `PATCH /api/admin/users/:id`.
* **CMS:** `GET /api/cms/:sectionKey`, `PUT /api/cms`.
* **Notifica√ß√µes:** `GET /api/notifications`, `PUT /api/notifications/:id/read`.
* **E-mail:** servi√ßo com **Resend** (`RESEND_API_KEY`) e **templates prontos** para:

  * ‚ÄúNova Assembleia‚Äù
  * ‚ÄúAta dispon√≠vel‚Äù
  * ‚ÄúProcura√ß√£o recebida‚Äù
    (envio **ass√≠ncrono** ap√≥s criar assembleia, etc.)

---

## 2) Gaps de UX/funcionalidade para Administrador

1. **Documentos**

   * Falta **upload** (POST) e **exclus√£o** (DELETE) via API + UI (atualmente s√≥ listar/baixar).
   * Falta **edi√ß√£o de metadados** (t√≠tulo, tipo, visibilidade, associa√ß√£o √† assembleia).
   * Falta **filtro por tipo/visibilidade/assembleia** e **busca** na UI.

2. **E-mails para associados**

   * H√° envios autom√°ticos para alguns eventos, mas falta um **envio administrativo em massa** (boletins/comunicados), com:

     * Preview, teste para um e-mail, logs de envio, contagem de destinat√°rios.
     * Sele√ß√£o de **segmento** (todos, s√≥ ativos, s√≥ dire√ß√£o, por presen√ßa numa assembleia, etc.).

3. **Assembleias & Vota√ß√µes**

   * Em assembleias: melhorar **checagem de conflitos** nas procura√ß√µes (o backend j√° tem fun√ß√£o de loop-check; expor feedback claro na UI).
   * Em vota√ß√µes: adicionar **r√≥tulos de estado** (agendada/aberta/encerrada), **confirma√ß√£o antes de encerrar**, **export CSV** de resultados.

4. **CMS**

   * Adicionar **versionamento simples** (guardar hist√≥rico e permitir ‚Äúreverter‚Äù).
   * **Preview** antes de publicar.

5. **Admin UX geral**

   * **Pesquisa global** (K-bar) para encontrar associado, documento, assembleia.
   * **A√ß√µes em massa**: ativar/inativar associados; enviar e-mail a um subset selecionado; apagar m√∫ltiplos documentos.
   * **Feedback de sistema**: toasts com detalhes (ex.: quantos e-mails enviados com sucesso/falhas, link para logs).

---

## 3) Roadmap priorizado (pr√°tico)

### P0 ‚Äî Documentos (CRUD completo)

* [ ] API: **POST /api/documents** (upload via `multer` + object storage), **DELETE /api/documents/:id**, **PUT /api/documents/:id** (metadados).
* [ ] UI (p√°gina **Documentos**):

  * [ ] Bot√£o **‚ÄúEnviar documentos‚Äù** (multi-arquivo, 10MB por arquivo).
  * [ ] **Tabela** com filtros (tipo, vis√≠vel para, assembleia) + busca por t√≠tulo.
  * [ ] A√ß√µes por item: **Baixar / Editar / Excluir**.
  * [ ] **A√ß√µes em massa** (sele√ß√£o + excluir).
  * [ ] Indicar **tamanho** e **quem fez upload**.

### P1 ‚Äî E-mail administrativo

* [ ] API: `POST /api/admin/email/broadcast` (segmentos + template + assunto + HTML/Markdown).
* [ ] UI: tela ‚Äú**Comunica√ß√µes**‚Äù

  * [ ] Form: assunto + editor (Markdown/HTML) + segmento (todos/ativos/dire√ß√£o/custom query).
  * [ ] **Preview**, **Enviar teste**, **Enviar**.
  * [ ] Mostrar **progresso** e **logs** (sucesso/falha por e-mail).
* [ ] Seguran√ßa/limites: rate-limit e logs; fallback de fila (retries).

### P2 ‚Äî Vota√ß√µes & Assembleias (UX)

* [ ] ‚Äú**Encerrar vota√ß√£o**‚Äù com modal de confirma√ß√£o e resumo.
* [ ] **Export CSV** de resultados e presen√ßas.
* [ ] UI de procura√ß√µes: badge de conflitos (exibe quem delega para quem; detecta ciclo/loop) e **resolver**/revogar com 1 clique.

### P3 ‚Äî CMS & Qualidade de Vida

* [ ] Versionamento simples (salvar snapshots) + **Preview**.
* [ ] Pesquisa global (K-bar) + atalhos.
* [ ] Acessibilidade: foco/labels/atalhos; avisos de contraste.

---

## 4) Implementa√ß√µes r√°pidas (c√≥digo)

### 4.1 Rotas de **Documentos** (backend ‚Äì `server/routes.ts`)

> Usa `multer` (j√° importado) + storage S3/Object-Storage (voc√™ j√° usa `@replit/object-storage`).

```ts
// Upload (admin)
const upload = multer({
  storage: multer.memoryStorage(),
  limits: { fileSize: 10 * 1024 * 1024 },
});

app.post("/api/documents", requireAdmin, upload.single("file"), async (req, res) => {
  try {
    const { titulo, tipo, visivelPara = "todos", assemblyId } = req.body;
    if (!req.file) return res.status(400).json({ message: "Arquivo √© obrigat√≥rio" });

    // grava no object storage (ex.: bucket "docs/")
    const key = `docs/${Date.now()}_${req.file.originalname}`;
    await objectClient.upload(key, req.file.buffer, { contentType: req.file.mimetype });

    const doc = await storage.createDocument({
      titulo,
      tipo,
      visivelPara,
      assemblyId: assemblyId ? Number(assemblyId) : null,
      filePath: key,
      fileSize: req.file.size,
      uploadedBy: getUserId(req),
    });

    res.status(201).json(doc);
  } catch (e: any) {
    res.status(500).json({ message: "Falha no upload", detail: e?.message });
  }
});

// Update metadados
app.put("/api/documents/:id", requireAdmin, async (req, res) => {
  try {
    const id = Number(req.params.id);
    const partial = (({ titulo, tipo, visivelPara, assemblyId }) => ({ titulo, tipo, visivelPara, assemblyId }))(req.body);
    const updated = await storage.updateDocument(id, partial);
    res.json(updated);
  } catch (e:any) {
    res.status(500).json({ message: "Falha ao atualizar documento", detail: e?.message });
  }
});

// Delete
app.delete("/api/documents/:id", requireAdmin, async (req, res) => {
  try {
    const id = Number(req.params.id);
    const doc = await storage.getDocumentById(id);
    if (!doc) return res.status(404).json({ message: "Documento n√£o encontrado" });

    await objectClient.delete(doc.filePath);
    await storage.deleteDocument(id);
    res.status(204).end();
  } catch (e:any) {
    res.status(500).json({ message: "Falha ao excluir documento", detail: e?.message });
  }
});
```

> **DB/Storage**: no `server/storage.ts`, garanta que existam `createDocument`, `updateDocument`, `deleteDocument` (Drizzle j√° tem a tabela `documents` com `titulo`, `tipo`, `visivelPara`, `assemblyId`, `filePath`, `fileSize`, `uploadedBy`, `createdAt`).

### 4.2 UI de **Documentos** (frontend ‚Äì `client/src/pages/Documentos.tsx`)

* Adicione:

  * `<input type="file" multiple />` ou modal de upload (shadcn/ui `Dialog`).
  * Tabela com colunas: **T√≠tulo** / **Tipo** / **Vis√≠vel para** / **Assembleia** / **Tamanho** / **A√ß√µes**.
  * Filtros (Select) e busca.
* Integra√ß√£o via `react-query`:

```ts
// listar
const docsQuery = useQuery({ queryKey: ["documents"], queryFn: () => apiRequest("/api/documents").then(r => r.json()) });

// upload
const uploadMutation = useMutation({
  mutationFn: async (formData: FormData) => fetch("/api/documents", { method: "POST", body: formData }),
  onSuccess: () => queryClient.invalidateQueries({ queryKey: ["documents"] })
});

// delete
const deleteMutation = useMutation({
  mutationFn: async (id: number) => apiRequest(`/api/documents/${id}`, { method: "DELETE" }),
  onSuccess: () => queryClient.invalidateQueries({ queryKey: ["documents"] })
});
```

### 4.3 **Envio de e-mail** administrativo (backend)

Reaproveita o `emailService.ts` (Resend) e cria endpoint:

```ts
app.post("/api/admin/email/broadcast", requireAdmin, async (req, res) => {
  const { subject, html, segmento = "todos", testePara } = req.body;

  // valida√ß√µes
  if (!subject || !html) return res.status(400).json({ message: "subject e html s√£o obrigat√≥rios" });

  // envio de teste
  if (testePara) {
    await sendEmail({ to: testePara, subject, html });
    return res.json({ preview: true });
  }

  // sele√ß√£o de destinat√°rios
  const all = await storage.getAllUsers();
  const destinatarios = all.filter(u => {
    if (segmento === "direcao") return u.papel === "direcao";
    if (segmento === "ativos") return u.ativo;
    return true; // todos
  });

  // envio em lotes simples (evita burst)
  const chunk = 100;
  for (let i = 0; i < destinatarios.length; i += chunk) {
    const slice = destinatarios.slice(i, i + chunk);
    await Promise.all(slice.map(u => sendEmail({ to: u.email, subject, html })));
  }

  res.json({ total: destinatarios.length });
});
```

**UI (nova p√°gina ‚ÄúComunica√ß√µes‚Äù)**

* Form com `subject`, editor (Markdown ‚Üí HTML), `Select` de **segmento** (‚ÄúTodos / Ativos / Dire√ß√£o / Custom‚Äù), bot√£o ‚Äú**Enviar teste**‚Äù, ‚Äú**Enviar**‚Äù.
* Mostrar **contador de destinat√°rios** (pr√©via via `GET /api/admin/users?segmento=...`).
* `react-query` para o POST; toast de sucesso/erro + link para **logs** (opcional: gravar em tabela `email_logs`).

### 4.4 **Resultados de vota√ß√£o / Presen√ßas ‚Äî CSV**

Endpoints simples:

```ts
app.get("/api/voting-items/:id/export", requireAdmin, async (req, res) => {
  const id = Number(req.params.id);
  const rows = await storage.getVotesByVotingItem(id);
  // monte um CSV com user, voto, peso
  const csv = toCSV(rows);
  res.type("text/csv").attachment(`votacao_${id}.csv`).send(csv);
});

app.get("/api/assemblies/:id/presences/export", requireAdmin, async (req, res) => {
  const id = Number(req.params.id);
  const rows = await storage.getPresencesByAssembly(id);
  const csv = toCSV(rows);
  res.type("text/csv").attachment(`presencas_${id}.csv`).send(csv);
});
```

---

## 5) Ajustes no Replit (para essas novidades)

* **Secrets**: al√©m de `DATABASE_URL`, adicione `RESEND_API_KEY` (para e-mails) e, se proteger `/__debug`, use `SESSION_SECRET`.
* **Depend√™ncias**:

  ```
  npm i multer cors helmet compression express-rate-limit
  ```
* **Build/Deploy**: o teu `.replit` j√° faz:

  * build: `npm run build` (Vite + esbuild do server)
  * run: `npm run start`
    Verifica que os **novos endpoints** estejam no bundle (`dist/index.js`) ap√≥s `npm run build`.
* **Health/Debug**:

  * `GET /health` ‚Üí monitora autoscale.
  * `GET /__debug?key=SESSION_SECRET` ‚Üí diagn√≥stico (n√£o esquecer de proteger em produ√ß√£o).

---

## 6) Checklist para ‚Äúdone‚Äù

* [ ] Upload de documentos funcionando (UI + POST + persist√™ncia + aparece na lista).
* [ ] Edi√ß√£o de metadados (PUT) e **excluir** (DELETE) com confirma√ß√£o.
* [ ] Filtros/busca em Documentos.
* [ ] Envio de **e-mail em massa** com preview e teste; logs ok.
* [ ] CSV de resultados e presen√ßas baixando corretamente.
* [ ] UX de procura√ß√µes mostrando conflitos (se houver) e a√ß√£o de resolver.
* [ ] CMS com preview.
* [ ] Healthcheck ok em produ√ß√£o; debug protegido.

---

Se quiser, eu te entrego **patches/diffs prontos** para:

* `server/routes.ts` (documentos + broadcast e-mail + CSV + health/debug)
* `client/src/pages/Documentos.tsx` (upload/filtros/a√ß√µes)
* nova p√°gina `client/src/pages/Comunicacoes.tsx`

diz s√≥ ‚Äúmanda os diffs‚Äù e eu j√° te passo os blocos certinhos pra colar.
